---
title: 浏览器工作原理
---

你好，昨晚跟中楷沟通过了，预计9月初到岗，我这边暂时还没有提离职，等这边 offer 来了，我和 leader 沟通一下，如果后面入职日期有变更，我会提前和你沟通~


## 打开一个页面为何有四个进程？
### 单进程浏览器 不稳定 不流畅 不安全
1. 因为运行在一个进程里，所以插件的崩溃也会导致浏览器的崩溃，同时渲染引擎模块的崩溃也会导致浏览器**不稳定**
2. 渲染，脚本执行插件执行都在一个线程里，会因为额外的事件导致浏览器卡顿，一旦有页面发生内存泄露，整个浏览器都会因为改页面变得**不流畅**
3. 恶意插件脚本可以获取系统资源，对用户电脑做恶意事情，导致用户设备**不安全**

### 多进程浏览器
> 现在的 chrome 进程架构包括一个浏览器进程，一个GPU进程，一个网络进程，多个渲染进程，多个插件进程
1. 浏览器进程：负责界面显示，用户交互，子进程管理，提供存储功能
2. 渲染进程：将 HTML，CSS，JS 转换为用户可以交互的网页，每一个 Tab 标签都会创建一个渲染进程
3. GPU 进程：
4. 网络进程：负责网络资源加载
5. 插件进程：执行插件，利用插件进程隔离，防止插件崩溃对浏览器造成影响

## TCP 协议：如何保证页面文件完整送达浏览器
1. TCP 对于数据包丢失的情况，提供了重传机制
2. 引入数据包排序机制，保证乱序数据包合成一个完整的文件

### 课后
1. 影响 FP 指标的因素
> First Paint = 页面开始展示时间 - 开始请求时间；First Contentful Paint = 首屏内容渲染结束时间点 - 开始请求的时间点
- FP 优化
  1. SSR
  2. 预渲染
  3. 骨架屏
- FCP 优化
  1. CDN 分发
  2. 静态文件缓存
  3. 资源动态加载，没有必要的文件不必加载
  4. 减少请求数量
  5. http2
  6. gzip 压缩传输文件大小
- 计算方法 performance.getEntriesByType('paint'), new MutationObserver((mutations) => {})

2. 为什么浏览器要进行三次握手四次挥手
三次握手
| 客户端 | 数据包 | 服务端 |
|:---:|:---:|:---:|
| syn-send | syn | syn-received |
| accept | syn / ack | send |
| send | ack | established |
- 第一次握手是表示 服务端可以知道：客户端发送能力，服务端接收能力正常
- 第二次握手表示 客户端知道：客户端和服务端的发送接收能力正常
- 第三次握手表示 服务端知道：客户端和服务端的发送接收能力正常
两次握手：客户端滞后的无用的消息可能因为其他原因在断开连接后才到达服务端，如果两次握手的话，会导致服务端不知道客户端已关闭一直等待客户端响应造成资源浪费
四次挥手
- 第一次：客户端认为数据发送完成，请求释放数据（FIN）
- 第二次：服务端通知
3. 七层网络

## 03-HTTP请求流程：为什么很多站点第二次打开速度会很快
> DNS 缓存和页面资源缓存都会加快第二次访问速度
### HTTP 请求流程
1. 构建请求行
2. 查找缓存
3. 准备 IP 地址和端口
4. 等待 TCP 队列
5. 建立 TCP 链接
6. 发送 HTTP 请求

### 服务端处理 HTTP 请求流程
1. 返回请求
2. 断开连接
3. 重定向

### 课后
1. DNS 工作原理
2. 重定向状态码 301 和 302 的区别
